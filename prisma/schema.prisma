generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
}

enum PublishStatus {
  DRAFT
  PUBLISHED
}

enum StaffCategory {
  PRINCIPAL
  TEACHER
  STAFF
}

enum MediaType {
  IMAGE
  VIDEO
}

model User {
  id          String    @id @default(cuid())
  name        String
  email       String    @unique
  password    String
  role        UserRole  @default(ADMIN)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  mediaAssets MediaAsset[]
}

model LoginRateLimit {
  id            String   @id @default(cuid())
  identifier    String   @unique
  failedCount   Int      @default(0)
  firstFailedAt DateTime?
  lockedUntil   DateTime?
  updatedAt     DateTime @updatedAt
}

model MediaAsset {
  id                 String    @id @default(cuid())
  publicId           String    @unique
  resourceType       MediaType @default(IMAGE)
  format             String?
  width              Int?
  height             Int?
  bytes              Int?
  altText            String?
  folder             String?
  createdById        String?
  createdAt          DateTime  @default(now())

  createdBy User? @relation(fields: [createdById], references: [id], onDelete: SetNull)

  staffAsPhoto StaffMember[] @relation("StaffPhoto")

  facilitiesAsThumb Facility[] @relation("FacilityThumbnail")

  activityLinks ActivityMedia[]

  galleryAlbumCovers GalleryAlbum[] @relation("GalleryAlbumCover")

  galleryItems GalleryItem[]
}

model Page {
  id              String        @id @default(cuid())
  slug            String        @unique
  title           String
  metaTitle       String?
  metaDescription String?
  status          PublishStatus @default(PUBLISHED)
  publishedAt     DateTime?
  updatedAt       DateTime      @updatedAt

  sections PageSection[]
}

model PageSection {
  id         String   @id @default(cuid())
  pageId     String
  sectionKey String
  heading    String?
  content    Json
  sortOrder  Int      @default(0)
  isVisible  Boolean  @default(true)
  updatedAt  DateTime @updatedAt

  page Page @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId, sortOrder])
  @@unique([pageId, sectionKey])
}

model StaffMember {
  id           String        @id @default(cuid())
  name         String
  position     String
  category     StaffCategory @default(TEACHER)
  bio          String?
  photoMediaId String?
  sortOrder    Int           @default(0)
  isActive     Boolean       @default(true)

  photo MediaAsset? @relation("StaffPhoto", fields: [photoMediaId], references: [id], onDelete: SetNull)
}

model Facility {
  id               String  @id @default(cuid())
  name             String
  description      String
  thumbnailMediaId String?
  sortOrder        Int     @default(0)
  isActive         Boolean @default(true)

  thumbnail MediaAsset? @relation("FacilityThumbnail", fields: [thumbnailMediaId], references: [id], onDelete: SetNull)
}

model Activity {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  description String
  isFeatured  Boolean       @default(false)
  publishedAt DateTime?
  status      PublishStatus @default(PUBLISHED)
  sortOrder   Int           @default(0)

  media ActivityMedia[]
}

model ActivityMedia {
  id         String @id @default(cuid())
  activityId String
  mediaId    String
  sortOrder  Int    @default(0)

  activity Activity  @relation(fields: [activityId], references: [id], onDelete: Cascade)
  media    MediaAsset @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([activityId, mediaId])
}

model GalleryAlbum {
  id            String        @id @default(cuid())
  title         String
  slug          String        @unique
  description   String?
  coverMediaId  String?
  publishedAt   DateTime?
  status        PublishStatus @default(PUBLISHED)

  cover MediaAsset? @relation("GalleryAlbumCover", fields: [coverMediaId], references: [id], onDelete: SetNull)

  items GalleryItem[]
}

model GalleryItem {
  id        String @id @default(cuid())
  albumId   String
  mediaId   String
  caption   String?
  sortOrder Int    @default(0)

  album GalleryAlbum @relation(fields: [albumId], references: [id], onDelete: Cascade)
  media MediaAsset   @relation(fields: [mediaId], references: [id], onDelete: Cascade)
}

model PpdbInfo {
  id           String  @id @default(cuid())
  periodYear   String
  requirements Json
  flowSteps    Json
  notes        String?
  isActive     Boolean @default(true)
  updatedAt    DateTime @updatedAt
}

model PpdbGraduate {
  id            String   @id @default(cuid())
  fullName      String
  registrationNo String?
  schoolOrigin  String?
  graduationYear String
  rank          Int?
  isPublished   Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([graduationYear, rank])
}

model ContactInfo {
  id                 String   @id @default(cuid())
  address            String
  phone              String
  email              String
  googleMapsEmbedUrl String?
  social             Json
  updatedAt          DateTime @updatedAt
}

model SiteSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
}
